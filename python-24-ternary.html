<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Simon Larsén" />
    <meta name="generator" content="Pelican (VoidyBootstrap theme)" />

    <title>The pre Python 2.5 ternary operator hack - Programming for fun and profit</title>

   
        <link rel="stylesheet"
              href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
              crossorigin="anonymous" />

      <link rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
            integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
            crossorigin="anonymous"
      />




      <link rel="stylesheet" href="https://slar.se/theme/css/pygment.css" />
      <link rel="stylesheet" href="https://slar.se/theme/css/voidybootstrap.css" />
      <link rel="stylesheet" href="https://slar.se/theme/css/search.css" />

    <link rel="shortcut icon" href="https://slar.se/favicon.ico" />
<link rel="stylesheet" href="https://files.stork-search.net/basic.css" />        <link href="https://slar.se/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Programming for fun and profit Atom Feed" />
  </head>

  <body>
   
    <nav class="navbar navbar-default">
      <div class="container">
	   <div class="navbar-header">
		<button type="button" class="navbar-toggle" 
				data-toggle="collapse" data-target="#main-navbar-collapse">
		  <span class="sr-only">Toggle navigation</span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		</button>
		<a class="navbar-brand" href="https://slar.se/" rel="home">
          <i class="fas fa-home fa-fw fa-lg"> </i> </a>
       </div>

      <div class="collapse navbar-collapse" id="main-navbar-collapse">
        <ul class="nav navbar-nav">
                  <li>
                    <a href="https://slar.se/pages/about.html">About</a>
                  </li>
                  <li>
                    <a href="https://slar.se/pages/publications-and-essays.html">Publications and Essays</a>
                  </li>
                  <li>
                    <a href="https://slar.se/pages/wiki.html">Wiki</a>
                  </li>
                  <li>
                    <a href="https://slar.se/pages/projects.html">Projects</a>
                  </li>
            <li class="divider"></li>
            <li class="">
              <a href="https://slar.se/archives.html">Archives</a>
            </li>
          <li class="divider"></li>
            <li><a href="https://slar.se/feeds/all.atom.xml" 
                   type="application/atom+xml" rel="alternate">
                <i class="fas fa-rss fa-fw fa-lg"></i> </a></li>
        </ul> <!-- /nav -->
      </div> <!-- /navbar-collapse -->
	  </div> <!-- /container -->
    </nav> <!-- /navbar -->

	<div class="jumbotron" id="overview">
	  <div class="container">
		<h1><a href="https://slar.se/">Programming for fun and profit</a></h1>
		<p class="lead">A blog about software engineering, programming languages and technical tinkering</p>
	  </div>
	</div>

    <div class="container" id="main-container">
      <div class="row">
        <div class="col-md-9" id="content">
<article itemscope="itemscope" itemtype="http://schema.org/BlogPosting">
  <header class="article-header">
<abbr class="article-header-date">
  Sun 06 November 2022
</abbr> <h1>
  <a href="https://slar.se/python-24-ternary.html" rel="bookmark"
     title="Permalink to The pre Python 2.5 ternary operator hack">
    The pre Python 2.5 ternary operator hack
  </a>
</h1><div class="article-header-info">
  <p>
      Posted by <a href="https://slar.se/author/simon-larsen.html">Simon Larsén</a>
    in 
    <a href="https://slar.se/category/programming.html">
      Programming</a>
    &nbsp;&nbsp;
  </p>
</div> <!-- /.article-header-info --><div class="article-tag-list">
<span class="label label-default">Tags</span>
	<a href="https://slar.se/tag/python.html"><i class="fas fa-tag"></i>python</a>&nbsp;
</div>  </header>
  <div class="content-body" itemprop="text articleBody">
	<p>The modern day ternary operator is well-known to most Pythonistas:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="n">expr_if_true</span><span class="o">&gt;</span> <span class="k">if</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span> <span class="k">else</span> <span class="o">&lt;</span><span class="n">expr_if_false</span><span class="o">&gt;</span>
</code></pre></div>

<p>It's officially known as a <em>conditional expression</em> and was introduced
back in Python 2.5 with <a href="https://www.regular-expressions.info/atomic.html">PEP
308</a>. Some like it, some
don't, and while discussing it with a colleague of mine he mentioned that there
"used to be something a whole lot worse" around the code bases written by
developers favoring ternary operators. He couldn't remember what it looked like
as these events are <a href="https://peps.python.org/pep-0356/">15 years in the past</a>,
but a few days later he came back to me with a code snippet like this:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="s2">&quot;nope&quot;</span><span class="p">,</span> <span class="s2">&quot;yep&quot;</span><span class="p">][</span><span class="kc">False</span><span class="p">]</span>
</code></pre></div>

<p>What?</p>
<h2>No ternary operator you say?</h2>
<p>Developers are creative and opinionated. Sometimes this mix leads to
monstrosities, such as when creative developers who really liked ternaries
created this pattern:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="o">&lt;</span><span class="n">expr_if_false</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">expr_if_true</span><span class="o">&gt;</span><span class="p">][</span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span>
</code></pre></div>

<p>You're reading that right. It's a list with two elements, the first of which
is returned if the condition is <code>False</code> and the second if it's <code>True</code>. Here is
an example:</p>
<div class="highlight"><pre><span></span><code><span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">message_modern</span> <span class="o">=</span> <span class="s2">&quot;success&quot;</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="s2">&quot;failure&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">message_modern</span><span class="p">)</span>   <span class="c1"># success</span>

<span class="n">message_old</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;failure&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">][</span><span class="n">condition</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">message_old</span><span class="p">)</span>      <span class="c1"># success</span>
</code></pre></div>

<p>This will make perfect sense to a C programmer: <code>True</code> and <code>1</code> are
interchangeable, as are <code>False</code> and <code>0</code>. And that's precisely how this works,
the underlying <a href="https://github.com/python/cpython/blob/2db55e0c0069a928775fa819973a76f840c5ab5a/Objects/listobject.c#L242-L255">function that implements the list index
access</a>
performs some rudimentary checks and then just uses the provided index as an
offset to the base pointer of the list.</p>
<h2>But the hack isn't quite the same</h2>
<p>At first glance, it may seem like the old hack with the list is functionally
equivalent to the modern ternary operator. It isn't quite, though, because it
lacks one very important property: lazy evaluation of the branches. In short,
the ternary operator only evaluates the branch that it returns. Here's an
example:</p>
<div class="highlight"><pre><span></span><code><span class="n">condition</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">result_modern</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="mi">42</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_modern</span><span class="p">)</span> <span class="c1"># 42</span>

<span class="n">result_old</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">][</span><span class="n">condition</span><span class="p">]</span> <span class="c1"># raises ZeroDivisionError: division by zero</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_old</span><span class="p">)</span>
</code></pre></div>

<p>The ternary operator does not result in a crash on division by zero as it does
not evaluate the expression in the true-branch, whereas the old hack crashes
immediately as it first evaluates both expressions and then returns one of them.
To fully emulate the modern behavior we'd need something like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">condition</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">result_old</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">][</span><span class="n">condition</span><span class="p">]()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_old</span><span class="p">)</span> <span class="c1"># 42</span>
</code></pre></div>

<p>Here we get lazy evaluation by virtue of wrapping the two branches in lambdas,
and then executing the lambda that's returned. I think we can all agree that's
not a pretty sight.</p>
<h2>Conditional expressions are a good thing</h2>
<p>Regardless of your stance on using ternary operators (or conditional
expressions, as they're called in Python), it's probably a good thing they
exist. Otherwise creative and opinionated programmers get around to hacks to
emulate the behavior that end up being completely unreadable to others.</p>
  </div>
  

</article>
        </div><!-- /content -->

        <div class="col-md-3 sidebar-nav" id="sidebar">

<div class="row">

<div class="col-xs-6 col-md-12">
<h4><i class="fas fa-comment fa-fw fa-lg"></i> Social</h4>
<ul class="list-unstyled social-links">
    <li><a href="https://www.linkedin.com/in/simon-lars%C3%A9n-b665b3102/" target="_blank">
	  <i class="fab fa-linkedin fa-fw fa-lg" title="LinkedIn"></i>
		LinkedIn
	</a></li>
    <li><a href="https://github.com/slarse" target="_blank">
	  <i class="fab fa-github-square fa-fw fa-lg" title="GitHub"></i>
		GitHub
	</a></li>
</ul>
</div>

<div class="col-xs-6 col-md-12">
<h4><i class="fas fa-folder fa-fw fa-lg"></i> Categories</h4>
<ul class="list-unstyled category-links">
  <li><a href="https://slar.se/category/blog.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Blog</a></li>
  <li><a href="https://slar.se/category/linux.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Linux</a></li>
  <li><a href="https://slar.se/category/programming.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Programming</a></li>
  <li><a href="https://slar.se/category/reviews.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Reviews</a></li>
  <li><a href="https://slar.se/category/testing.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Testing</a></li>
  <li><a href="https://slar.se/category/tip-of-the-week.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Tip of the Week</a></li>
</ul>
</div>

</div> <!-- /row -->

<h4><i class="fas fa-tags fa-fw fa-lg"></i> Tags</h4>
<p class="tag-cloud">
    <span class="tag-2">
      <a href="https://slar.se/tag/testing.html">
          <i class="fas fa-tag"></i>
        testing
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/intellij.html">
          <i class="fas fa-tag"></i>
        intellij
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/kotlin.html">
          <i class="fas fa-tag"></i>
        kotlin
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/enums.html">
          <i class="fas fa-tag"></i>
        enums
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/unit-testing.html">
          <i class="fas fa-tag"></i>
        unit testing
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/software-engineering.html">
          <i class="fas fa-tag"></i>
        software engineering
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/tornadofx.html">
          <i class="fas fa-tag"></i>
        tornadofx
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/book-review.html">
          <i class="fas fa-tag"></i>
        book review
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/javascript.html">
          <i class="fas fa-tag"></i>
        javascript
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/programming-languages.html">
          <i class="fas fa-tag"></i>
        programming languages
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/git.html">
          <i class="fas fa-tag"></i>
        git
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/html.html">
          <i class="fas fa-tag"></i>
        html
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/kuizzy.html">
          <i class="fas fa-tag"></i>
        kuizzy
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/python.html">
          <i class="fas fa-tag"></i>
        python
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/pytest.html">
          <i class="fas fa-tag"></i>
        pytest
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/css.html">
          <i class="fas fa-tag"></i>
        css
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/rust.html">
          <i class="fas fa-tag"></i>
        rust
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/exposed.html">
          <i class="fas fa-tag"></i>
        exposed
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/repobee.html">
          <i class="fas fa-tag"></i>
        repobee
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/java.html">
          <i class="fas fa-tag"></i>
        java
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/learning.html">
          <i class="fas fa-tag"></i>
        learning
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/data-structures.html">
          <i class="fas fa-tag"></i>
        data structures
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/podcast.html">
          <i class="fas fa-tag"></i>
        podcast
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/blog.html">
          <i class="fas fa-tag"></i>
        blog
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/bash.html">
          <i class="fas fa-tag"></i>
        bash
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/gradle.html">
          <i class="fas fa-tag"></i>
        gradle
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/bst.html">
          <i class="fas fa-tag"></i>
        bst
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/linux.html">
          <i class="fas fa-tag"></i>
        linux
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/totw.html">
          <i class="fas fa-tag"></i>
        totw
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/testing-tips.html">
          <i class="fas fa-tag"></i>
        testing tips
      </a>
    </span>
</p>
<h4><i class="fas fa-rss fa-fw fa-lg"></i> Feeds</h4>
<ul class="list-unstyled">
    <li><a href="https://slar.se/feeds/all.atom.xml" 
		   type="application/atom+xml" rel="alternate">
		<i class="fas fa-rss-square fa-fw fa-lg"></i> Atom Feed</a></li>
</ul>

<hr />

        </div><!--/sidebar -->
      </div><!--/row-->
    </div><!--/.container /#main-container -->

    <footer id="site-footer">
 
      <address id="site-colophon">
        <p class="text-center text-muted">
        Site built using <a href="http://getpelican.com/" target="_blank">Pelican</a>
        &nbsp;&bull;&nbsp; Theme based on
        <a href="http://www.voidynullness.net/page/voidy-bootstrap-pelican-theme/"
           target="_blank">VoidyBootstrap</a> by 
        <a href="http://voidynullness.net"
           target="_blank">RKI</a>  
        </p>
      </address><!-- /colophon  -->
    </footer>


    <!-- javascript -->
   
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>


<script src="https://files.stork-search.net/releases/v1.2.1/stork.js"></script>
<script>
    stork.register("sitesearch", "https://slar.se/search-index.st")
</script>  </body>
</html>