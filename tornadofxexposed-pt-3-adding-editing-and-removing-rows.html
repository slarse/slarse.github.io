<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Simon Larsén" />
    <meta name="generator" content="Pelican (VoidyBootstrap theme)" />

    <title>TornadoFX+Exposed pt. 3: Adding, editing and removing rows - Programming for fun and profit</title>

   
        <link rel="stylesheet"
              href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
              crossorigin="anonymous" />

      <link rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
            integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
            crossorigin="anonymous"
      />




      <link rel="stylesheet" href="https://slar.se/theme/css/pygment.css" />
      <link rel="stylesheet" href="https://slar.se/theme/css/voidybootstrap.css" />
      <link rel="stylesheet" href="https://slar.se/theme/css/search.css" />

    <link rel="shortcut icon" href="https://slar.se/favicon.ico" />
<link rel="stylesheet" href="https://files.stork-search.net/basic.css" />        <link href="https://slar.se/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Programming for fun and profit Atom Feed" />
  </head>

  <body>
   
    <nav class="navbar navbar-default">
      <div class="container">
	   <div class="navbar-header">
		<button type="button" class="navbar-toggle" 
				data-toggle="collapse" data-target="#main-navbar-collapse">
		  <span class="sr-only">Toggle navigation</span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		</button>
		<a class="navbar-brand" href="https://slar.se/" rel="home">
          <i class="fas fa-home fa-fw fa-lg"> </i> </a>
       </div>

      <div class="collapse navbar-collapse" id="main-navbar-collapse">
        <ul class="nav navbar-nav">
                  <li>
                    <a href="https://slar.se/pages/about.html">About</a>
                  </li>
                  <li>
                    <a href="https://slar.se/pages/publications-and-essays.html">Publications and Essays</a>
                  </li>
                  <li>
                    <a href="https://slar.se/pages/wiki.html">Wiki</a>
                  </li>
                  <li>
                    <a href="https://slar.se/pages/projects.html">Projects</a>
                  </li>
            <li class="divider"></li>
            <li class="">
              <a href="https://slar.se/archives.html">Archives</a>
            </li>
          <li class="divider"></li>
            <li><a href="https://slar.se/feeds/all.atom.xml" 
                   type="application/atom+xml" rel="alternate">
                <i class="fas fa-rss fa-fw fa-lg"></i> </a></li>
        </ul> <!-- /nav -->
      </div> <!-- /navbar-collapse -->
	  </div> <!-- /container -->
    </nav> <!-- /navbar -->

	<div class="jumbotron" id="overview">
	  <div class="container">
		<h1><a href="https://slar.se/">Programming for fun and profit</a></h1>
		<p class="lead">A blog about software engineering, programming languages and technical tinkering</p>
	  </div>
	</div>

    <div class="container" id="main-container">
      <div class="row">
        <div class="col-md-9" id="content">
<article itemscope="itemscope" itemtype="http://schema.org/BlogPosting">
  <header class="article-header">
<abbr class="article-header-date">
  Sun 30 December 2018
</abbr> <h1>
  <a href="https://slar.se/tornadofxexposed-pt-3-adding-editing-and-removing-rows.html" rel="bookmark"
     title="Permalink to TornadoFX+Exposed pt. 3: Adding, editing and removing rows">
    TornadoFX+Exposed pt. 3: Adding, editing and removing rows
  </a>
</h1><div class="article-header-info">
  <p>
      Posted by <a href="https://slar.se/author/simon-larsen.html">Simon Larsén</a>
    in 
    <a href="https://slar.se/category/programming.html">
      Programming</a>
    &nbsp;&nbsp;
  </p>
</div> <!-- /.article-header-info --><div class="article-tag-list">
<span class="label label-default">Tags</span>
	<a href="https://slar.se/tag/exposed.html"><i class="fas fa-tag"></i>exposed</a>&nbsp;
	<a href="https://slar.se/tag/kotlin.html"><i class="fas fa-tag"></i>kotlin</a>&nbsp;
	<a href="https://slar.se/tag/kuizzy.html"><i class="fas fa-tag"></i>kuizzy</a>&nbsp;
	<a href="https://slar.se/tag/tornadofx.html"><i class="fas fa-tag"></i>tornadofx</a>&nbsp;
</div>  </header>
  <div class="content-body" itemprop="text articleBody">
	<p>Welcome to the third and final part in this article series on using TornadoFX
together with Exposed. In the previous two parts, we set up the database with a
single table and created a simple TornadoFX view with which we could view its
contents. Now, we will focus on adding and deleting rows to the <code>Categories</code>
table, as well as adding new ones. This part is a bit longer than the two
previous ones, but it also contains a whole lot more content.</p>
<blockquote>
<p>The full source code is available
<a href="https://github.com/slarse/tornadofx-exposed-example/tree/part_3">on GitHub</a></p>
</blockquote>
<h1>Article index</h1>
<ol>
<li><a href="https://slar.se/tornadofxexposed-pt-1-project-and-database-setup.html">Project and database setup</a></li>
<li><a href="https://slar.se/tornadofxexposed-pt-2-showing-a-database-table.html">Showing a database table</a></li>
<li>Adding, editing and removing rows -- This part!</li>
</ol>
<h1>Making the app interactive</h1>
<p>So far, all we can do with our app is view the contents of the database. That's
neat and all, but it would be even nicer if we could interact with the database
and edit its contents. What this article will address is how to:</p>
<ol>
<li>Delete rows.</li>
<li>Add rows.</li>
<li>Edit rows.</li>
</ol>
<p>Deleting rows is the simplest thing to accomplish, so let's start with that.</p>
<h2>Deleting rows</h2>
<p>Deleting a row is pretty easy. First, we'll add the desired functionality to
the controller.</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteCategory</span><span class="p">(</span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">CategoryModel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">transaction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">item</span><span class="p">.</span><span class="na">delete</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">categories</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Note that <code>model.item</code> returns the backing <code>Category</code> object, on which we
simply call <code>delete()</code> to remove it from the database. Then, we also have to
update our local list by removing the model from it. Note that I assume <code>model</code>
to be in the <code>categories</code> list for the sake of simplicity, but this is a pretty
bold assumption that you probably should not make in a real application. Now,
let's put this new functionality to work: we need to add a button to the view
that calls the delete function on the currently selected row. We will slightly
alter the layout to make this happen. We change this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">borderpane</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbController</span><span class="p">.</span><span class="na">categories</span><span class="w"></span>

<span class="w">    </span><span class="n">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tableview</span><span class="o">&lt;</span><span class="n">CategoryModel</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">categoryTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editModel</span><span class="w"></span>
<span class="w">        </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categories</span><span class="w"></span>

<span class="w">        </span><span class="n">column</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryModel</span><span class="o">::</span><span class="n">name</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">column</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryModel</span><span class="o">::</span><span class="n">description</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>to this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">borderpane</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbController</span><span class="p">.</span><span class="na">categories</span><span class="w"></span>

<span class="w">    </span><span class="n">center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vbox</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">buttonbar</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">button</span><span class="p">(</span><span class="s">&quot;DELETE SELECTED&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">action</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="kd">val</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categoryTable</span><span class="p">.</span><span class="na">tableView</span><span class="p">.</span><span class="na">selectedItem</span><span class="w"></span>
<span class="w">                    </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">return</span><span class="nd">@action</span><span class="w"></span>
<span class="w">                        </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">dbController</span><span class="p">.</span><span class="na">deleteCategory</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">tableview</span><span class="o">&lt;</span><span class="n">CategoryModel</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">categoryTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editModel</span><span class="w"></span>
<span class="w">            </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categories</span><span class="w"></span>

<span class="w">            </span><span class="n">column</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryModel</span><span class="o">::</span><span class="n">name</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">column</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryModel</span><span class="o">::</span><span class="n">description</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We use a <code>buttonbar</code> as we will be adding more buttons later on. The code should
be fairly easy to read: the button's action will do nothing if the currently
selected model is <code>null</code> (i.e. nothing is selected), and call the
<code>deleteCategory</code> method otherwise. You should now have a view looking something
like this:</p>
<p><img alt="Table view with a delete button" src="https://slar.se/images/tornado_exposed/view_with_delete.jpg"></p>
<p>If you first click a row and then the delete button, the row should disappear.
Now that we can delete rows, let's turn our attention to adding new rows.</p>
<h2>Adding new rows</h2>
<p>For this, we're going to add a small form to the right of the table which will
allow us to enter new rows. As before, we'll start with the controller, adding
the following method to it:</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">addCategory</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">transaction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Category</span><span class="p">.</span><span class="na">new</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">description</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">categories</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">CategoryModel</span><span class="p">().</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">category</span><span class="w"></span>
<span class="w">            </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Here, we first create a new <code>Category</code>, and then add it to the <code>categories</code>
list (wrapped in a <code>CategoryModel</code>). Now, we need to add the form to the view
so we can submit the values for <code>name</code> and <code>description</code>. First, we need to add
two new properties to the <code>CategoryEditor</code> view:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nv">nameField</span><span class="p">:</span><span class="w"> </span><span class="n">TextField</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">singleAssign</span><span class="p">()</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nv">descriptionField</span><span class="p">:</span><span class="w"> </span><span class="n">TextField</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">singleAssign</span><span class="p">()</span><span class="w"></span>
</code></pre></div>

<p>We need these to be able to access what we put in the form fields.  We also
need to import <code>TextField</code></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">javafx.scene.control.TextField</span><span class="w"></span>
</code></pre></div>

<p>To add the actual form, we put the following <em>after</em> the <code>center</code> element:</p>
<div class="highlight"><pre><span></span><code><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">fieldset</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">field</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">textfield</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">nameField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">fieldset</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">field</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">textfield</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">descriptionField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">button</span><span class="p">(</span><span class="s">&quot;ADD CATEGORY&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">action</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">dbController</span><span class="p">.</span><span class="na">addCategory</span><span class="p">(</span><span class="n">nameField</span><span class="p">.</span><span class="na">text</span><span class="p">,</span><span class="w"> </span><span class="n">descriptionField</span><span class="p">.</span><span class="na">text</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">nameField</span><span class="p">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
<span class="w">            </span><span class="n">descriptionField</span><span class="p">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>This will result in a view looking something like this:</p>
<p><img alt="View with add category form" src="https://slar.se/images/tornado_exposed/view_with_add_form.jpg"></p>
<p>Writing some stuff in the fields and clicking <code>ADD CATEGORY</code> should immediately
create a new row in the table. Not the most beautiful thing in the world, I'll
admit, but it serves its purpose for this guide. Now we only have one more
feature to add, namely editing rows.</p>
<h2>Editing rows</h2>
<p>Now we will finally see why we used a <code>TableViewEditModel</code> instead of a plain
<code>TableView</code>: the former allows us to edit rows directly in the table. To allow
for inline editing, we need to add some stuff to the view itself. Our table
view currently looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">tableview</span><span class="o">&lt;</span><span class="n">CategoryModel</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">categoryTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editModel</span><span class="w"></span>
<span class="w">    </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categories</span><span class="w"></span>

<span class="w">    </span><span class="n">column</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryModel</span><span class="o">::</span><span class="n">name</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">column</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryModel</span><span class="o">::</span><span class="n">description</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>To enable editing, we simply add a call to <code>enableCellEditing()</code>, and call
<code>makeEditable()</code> on the columns. We'll also add <code>enableDirtyTracking()</code> to
allow us to see which cells have been edited, but not saved.</p>
<div class="highlight"><pre><span></span><code><span class="n">tableview</span><span class="o">&lt;</span><span class="n">CategoryModel</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">categoryTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editModel</span><span class="w"></span>
<span class="w">    </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categories</span><span class="w"></span>

<span class="w">    </span><span class="n">enableCellEditing</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">enableDirtyTracking</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">column</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryModel</span><span class="o">::</span><span class="n">name</span><span class="p">).</span><span class="na">makeEditable</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">column</span><span class="p">(</span><span class="s">&quot;Description&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CategoryModel</span><span class="o">::</span><span class="n">description</span><span class="p">).</span><span class="na">makeEditable</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Now, we can edit cells by clicking them:</p>
<p><img alt="Editing a cell" src="https://slar.se/images/tornado_exposed/editing_cell.jpg"></p>
<p>And after pressing enter, we can see that the cell has been edited by the blue
triangle. The cell is <em>dirty</em>:</p>
<p><img alt="Dirty cell" src="https://slar.se/images/tornado_exposed/edited_cell.jpg"></p>
<p>However, the change won't "stick". If we restart the application, the text will
be back to what it was before we edited the cell. The reason is that the change
was never committed to the database, it was just stored in the model. Thus,
what we need now is to commit any dirty rows to the database. As always, we
start with adding the functionality we need from the controller.</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">commitDirty</span><span class="p">(</span><span class="n">modelDirtyMappings</span><span class="p">:</span><span class="w"> </span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Map</span><span class="p">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">CategoryModel</span><span class="p">,</span><span class="w"> </span><span class="n">TableColumnDirtyState</span><span class="o">&lt;</span><span class="n">CategoryModel</span><span class="o">&gt;&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">transaction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">modelDirtyMappings</span><span class="p">.</span><span class="na">filter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">isDirty</span><span class="w"> </span><span class="p">}.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nb">it</span><span class="p">.</span><span class="na">key</span><span class="p">.</span><span class="na">commit</span><span class="p">()</span><span class="w">     </span><span class="c1">// commit value to database</span><span class="w"></span>
<span class="w">            </span><span class="nb">it</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">commit</span><span class="p">()</span><span class="w">   </span><span class="c1">// clear dirty state</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>This function iterates over a sequence of map entries that map a model (key) to
a dirty state (value). We'll soon see that we can get such a map from the table
view. Note that committing the key <em>must</em> be done in a transaction, as it will
write to the database. The type is a bit of a mouthful, though, so let's define
a type alias for it.</p>
<div class="highlight"><pre><span></span><code><span class="k">typealias</span><span class="w"> </span><span class="n">ModelToDirtyState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Map</span><span class="p">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">CategoryModel</span><span class="p">,</span><span class="w"> </span><span class="n">TableColumnDirtyState</span><span class="o">&lt;</span><span class="n">CategoryModel</span><span class="o">&gt;&gt;</span><span class="w"></span>
</code></pre></div>

<p>Note that the <code>typealias</code> must be a top level declaration (i.e. you can't put
it in a class or function). And rewrite the header of <code>commitDirty</code> like this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">commitDirty</span><span class="p">(</span><span class="n">modelDirtyMappings</span><span class="p">:</span><span class="w"> </span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">ModelToDirtyState</span><span class="o">&gt;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>Slightly more readable, right? Now, let's put it to use. We'll add a new button
in the button bar to execute the commit.</p>
<div class="highlight"><pre><span></span><code><span class="n">button</span><span class="p">(</span><span class="s">&quot;COMMIT&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">action</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">dbController</span><span class="p">.</span><span class="na">commitDirty</span><span class="p">(</span><span class="n">categoryTable</span><span class="p">.</span><span class="na">items</span><span class="p">.</span><span class="na">asSequence</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Clicking this button when there are dirty cells will allow us to commit these
to the database. As a finishing touch, we'll add a button to reset (rollback)
dirty cells to their previous state.</p>
<div class="highlight"><pre><span></span><code><span class="n">button</span><span class="p">(</span><span class="s">&quot;ROLLBACK&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">action</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">categoryTable</span><span class="p">.</span><span class="na">rollback</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Note that this does not require a transaction, as all that happens is that the
model state is reset (the DAO is unaffected). This will leave us with a final
GUI looking like this:</p>
<p><img alt="Final GUI" src="https://slar.se/images/tornado_exposed/final_gui.jpg"></p>
<h1>Closing words</h1>
<p>That was all for this series of articles on TornadoFX and exposed. This is by
no means a fully-fledged database UI, but it is a pretty good start.  There are
tons of things here that need to be improved, though. Below are a few examples
off the top of my head.</p>
<ul>
<li>There is just about no error handling, everything is just assumed to work
  out.  For example, if a user enters a duplicate category, an unhandled
  exception is raised.</li>
<li>Much of the functionality is very specific to the <code>Category</code> type, and needs
  to be generalized. As a lot of this is done with generics, such
  generalization is actually not trivial (as generic types are invariant by
  default).</li>
<li>There is a lot of room for user error. For example, deleting a row is done
  without prompting the user with something like "Are you sure you wanna do
  this?". The commit/rollback functionality of editing is much more user
  friendly and a step in the right direction.</li>
<li>The views are completely unstyled and look rather dull.</li>
</ul>
<p>And with that, I wish you good fortune in working with this! Of course, you are
free to use all of these examples as you see fit.</p>
  </div>
  

</article>
        </div><!-- /content -->

        <div class="col-md-3 sidebar-nav" id="sidebar">

<div class="row">

<div class="col-xs-6 col-md-12">
<h4><i class="fas fa-comment fa-fw fa-lg"></i> Social</h4>
<ul class="list-unstyled social-links">
    <li><a href="https://www.linkedin.com/in/simon-lars%C3%A9n-b665b3102/" target="_blank">
	  <i class="fab fa-linkedin fa-fw fa-lg" title="LinkedIn"></i>
		LinkedIn
	</a></li>
    <li><a href="https://github.com/slarse" target="_blank">
	  <i class="fab fa-github-square fa-fw fa-lg" title="GitHub"></i>
		GitHub
	</a></li>
</ul>
</div>

<div class="col-xs-6 col-md-12">
<h4><i class="fas fa-folder fa-fw fa-lg"></i> Categories</h4>
<ul class="list-unstyled category-links">
  <li><a href="https://slar.se/category/blog.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Blog</a></li>
  <li><a href="https://slar.se/category/linux.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Linux</a></li>
  <li><a href="https://slar.se/category/programming.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Programming</a></li>
  <li><a href="https://slar.se/category/reviews.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Reviews</a></li>
  <li><a href="https://slar.se/category/testing.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Testing</a></li>
  <li><a href="https://slar.se/category/tip-of-the-week.html" >
    <i class="fas fa-folder-open fa-fw fa-lg"></i> Tip of the Week</a></li>
</ul>
</div>

</div> <!-- /row -->

<h4><i class="fas fa-tags fa-fw fa-lg"></i> Tags</h4>
<p class="tag-cloud">
    <span class="tag-3">
      <a href="https://slar.se/tag/java.html">
          <i class="fas fa-tag"></i>
        java
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/xps15.html">
          <i class="fas fa-tag"></i>
        xps15
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/tornadofx.html">
          <i class="fas fa-tag"></i>
        tornadofx
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/linux.html">
          <i class="fas fa-tag"></i>
        linux
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/git.html">
          <i class="fas fa-tag"></i>
        git
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/data-structures.html">
          <i class="fas fa-tag"></i>
        data structures
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/bst.html">
          <i class="fas fa-tag"></i>
        bst
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/book-review.html">
          <i class="fas fa-tag"></i>
        book review
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/bash.html">
          <i class="fas fa-tag"></i>
        bash
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/programming-languages.html">
          <i class="fas fa-tag"></i>
        programming languages
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/testing-tips.html">
          <i class="fas fa-tag"></i>
        testing tips
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/learning.html">
          <i class="fas fa-tag"></i>
        learning
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/testing.html">
          <i class="fas fa-tag"></i>
        testing
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/gradle.html">
          <i class="fas fa-tag"></i>
        gradle
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/css.html">
          <i class="fas fa-tag"></i>
        css
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/podcast.html">
          <i class="fas fa-tag"></i>
        podcast
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/software-engineering.html">
          <i class="fas fa-tag"></i>
        software engineering
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/repobee.html">
          <i class="fas fa-tag"></i>
        repobee
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/html.html">
          <i class="fas fa-tag"></i>
        html
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/enums.html">
          <i class="fas fa-tag"></i>
        enums
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/exposed.html">
          <i class="fas fa-tag"></i>
        exposed
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/blog.html">
          <i class="fas fa-tag"></i>
        blog
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/javascript.html">
          <i class="fas fa-tag"></i>
        javascript
      </a>
    </span>
    <span class="tag-2">
      <a href="https://slar.se/tag/kotlin.html">
          <i class="fas fa-tag"></i>
        kotlin
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/python.html">
          <i class="fas fa-tag"></i>
        python
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/rust.html">
          <i class="fas fa-tag"></i>
        rust
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/kuizzy.html">
          <i class="fas fa-tag"></i>
        kuizzy
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/intellij.html">
          <i class="fas fa-tag"></i>
        intellij
      </a>
    </span>
    <span class="tag-3">
      <a href="https://slar.se/tag/pytest.html">
          <i class="fas fa-tag"></i>
        pytest
      </a>
    </span>
    <span class="tag-4">
      <a href="https://slar.se/tag/unit-testing.html">
          <i class="fas fa-tag"></i>
        unit testing
      </a>
    </span>
    <span class="tag-1">
      <a href="https://slar.se/tag/totw.html">
          <i class="fas fa-tag"></i>
        totw
      </a>
    </span>
</p>
<h4><i class="fas fa-rss fa-fw fa-lg"></i> Feeds</h4>
<ul class="list-unstyled">
    <li><a href="https://slar.se/feeds/all.atom.xml" 
		   type="application/atom+xml" rel="alternate">
		<i class="fas fa-rss-square fa-fw fa-lg"></i> Atom Feed</a></li>
</ul>

<hr />

        </div><!--/sidebar -->
      </div><!--/row-->
    </div><!--/.container /#main-container -->

    <footer id="site-footer">
 
      <address id="site-colophon">
        <p class="text-center text-muted">
        Site built using <a href="http://getpelican.com/" target="_blank">Pelican</a>
        &nbsp;&bull;&nbsp; Theme based on
        <a href="http://www.voidynullness.net/page/voidy-bootstrap-pelican-theme/"
           target="_blank">VoidyBootstrap</a> by 
        <a href="http://voidynullness.net"
           target="_blank">RKI</a>  
        </p>
      </address><!-- /colophon  -->
    </footer>


    <!-- javascript -->
   
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>


<script src="https://files.stork-search.net/releases/v1.2.1/stork.js"></script>
<script>
    stork.register("sitesearch", "https://slar.se/search-index.st")
</script>  </body>
</html>